## Модуль "curl:protocols/http"

### Предоставляет базовую работу с протоколами HTTP/HTTPS

#### Разбит на две части: http, http.async
Функции в **http** могут быть использованы только в корутинах и предназначены для синхронного выполнения запросов. После отправки запроса ответ ожидается в цикле, после чего корутина возобновляется и функция возвращает результат

Функции в **http.async** же напротив, предназначены для асинхронного выполнения запросов. После отправки запроса ответ также ожидается, однако теперь ответ обрабатывается во время выполнения тика. После обработки ответа он передаётся функции, указанной в параметрах

Снизу будут предоставлены только функции в **http**, однако у функций в **http.async** точно такие же аргументы, поэтому трудностей не будет

#### Функции

Отправляет запрос на HTTP сервер. Метод запроса указывается в первом аргументе. Это может быть любой метод, используемый в пяти ниже описанных функциях. Метод должен быть представлен ввиде строки, регистр не важен. Все константы находятся в таблице **http.methods**

Возвращает 3 значения: тело ответа, голова ответа, внутренняя ошибка (если таковая имеется)

В случае с **async** значения те же самые, только они передаются в указанную в параметрах функцию вместо возврата

Если произошла внутренняя ошибка, то она будет представлена ввиде целого числа. Получить описание ошибки можно получив элемент по индексу из таблицы **http.errors**
```lua
function http.request(method, url, params)
```

Отправляет *HEAD* запрос на HTTP сервер

В возвращаемых/передаваемых значениях тело ответа и голова ответа переставлены на противоположные места. Т.е. первое значение - голова ответа, второе - тело ответа
```lua
function http.head(url, params)
```

Отправляет *GET* запрос на HTTP сервер
```lua
function http.get(url, params)
```

Отправляет *POST* запрос на HTTP сервер
```lua
function http.post(url, params)
```

Отправляет *PUT* запрос на HTTP сервер
```lua
function http.put(url, params)
```

Отправляет *DELETE* запрос на HTTP сервер
```lua
function http.delete(url, params)
```

### Структура head (голова ответа)

**head** - это таблица, которая содержит в себе техническую информацию и заголовки. 

**head.version** - версия **HTTP** используемая сервером. Строка.
**head.response_code** - код ответа. Целое число.
**head.major_response_code** - первая цифра **head.response_code** (1-5).
**head.response_code_description** - описание кода ответа. Строка.
**head.status** - текстовое описание **head.major_response_code** взятое из таблицы **http.statuses** под соответствующим индексом. Равно **info**, **success**, **redirection**, **client error** или **server_error**.
**head.headers** - заголовки. Представлены ввиде таблицы, где ключ и значение - строки. Регистр всех ключей - нижний.

### Структура params

**params** - это таблица со всеми дополнительными аргументами. Таблица вместо привычных аргументов была выбрана потому, что аргументов было слишком много.

#### Параметр **headers**
Заголовки, которые будут добавлены в голову запроса. Должен быть представлен ввиде таблицы, где каждый ключ и значение - строка

#### Параметр **body**
Тело запроса. В нём содержится двоичная или текстовая информация. Это также могут быть несериализованные данные, которые будут сериализованы через модуль **curl:utils/content_types**. Параметр может быть представлен ввиде любого типа данных, главное, чтобы он смог сериализоваться как указанный тип

#### Параметр **bodyType**
Определяет тип несериализованного контента, который будет сериализован и передан как тело запроса. Параметр должен быть представлен ввиде строки, которая идентифицирует тип несериализованного контента. Это может быть любой зарегистрированный в модуле **curl:utils/content_types** тип

#### Параметр **secured**
Определяет, будет ли использоваться протокол **HTTPS**. Должен быть представлен ввиде логического булева. Если равен **true**, то будет использоваться только протокол **HTTPS**. Может избавить от лишней переадресации, если адресат использует этот протокол

#### Параметр **autoRedirect**
Должен быть представлен ввиде логического булева. Если равен **true**, то если в голове ответа будет код 3xx, произойдёт автоматическая переадресация на адрес, из заголовка **location**. Максимальное количество переадресаций определяется следующим параметром. Если это количество будет превышено, то упадёт внутренняя ошибка под кодом 1


#### Параметр **maxRedirectionsCount**
Определяет максимальное количество автоматических переадресаций. Должен быть представлен ввиде целого числа. Значение по-умолчанию - **5**. Явное определение не имеет смысла без включённого **autoRedirect**

#### Параметр **forms**
Определяет формы HTML страницы, которые будут про эмулированы. Должен быть представлен ввиде индексированной таблицы, где каждый элемент в формате:

```lua
{ type = "тип контента", name = "название формы", content = --[[ сам контент --]] }
```

**type** определяет тип несериализованного контента формы, **name** определяет имя формы, а **content** непосредственно сам контент

Значение **type** по умолчанию - **text**

Параметр **content** не является обязательным.

Используется преимущественно только для *POST* запросов


#### Параметр **responseType**
Определяет тип сериализованного тела ответа. При получении ответа, тело будет десериализовано как указанный тип. Значение по-умолчанию - **text**


#### Параметр **responseHandler** (только **async**)
Определяет функцию, которая будет вызвана после получения финального ответа. Ей будут переданы в аргумент значения, которая указывались и подробно обьяснялись в начале информации о модуле

Пример синхронного *GET* запроса:
```lua
local info, head = http.get("voxelworld.ru/api/v1/mods",
	{
		responseType = "dirty_json",
		secured = true
	}
)
```

Пример синхронного *POST* запроса:
```lua
local info, head = http.post("catbox.moe/user/api.php",
	{
		forms =
		{
			{ name = "reqtype", content = "fileupload" },
			{ name = "userhash" },
			{ type = "file", name = "fileToUpload", content = "world:world.json" }
		},
		secured = true
	}
)
```